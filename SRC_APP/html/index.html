<html>
<head><title>Velogen</title>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="./gauge.min.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript">
	var wsUri = "ws://"+window.location.host+"/debug/ws.cgi";
	// var wsUri = "ws://velogen/debug/ws.cgi";
	var outV, outI, state, gV, gI;

	function init() {
	    outV = document.getElementById("outputV");
	    outI = document.getElementById("outputI");
		var gV = new RadialGauge({ 
			renderTo: "outputV",
			width: 200,
		    height: 200,
		    units: 'V',
		    title: "Battery Voltage",
		    minValue: 2.5,
		    maxValue: 5,
		    majorTicks: [ 2.5, 3, 3.5, 4, 4.5, 5 ],
	     	minorTicks: 5,
    		strokeTicks: true,
    		highlights: [ {
		        "from": 2.5,
		        "to": 3.2,
		        "color": "rgba( 0, 0, 255, .3)"
		    },{
		        "from": 4.2,
		        "to": 5,
		        "color": "rgba(255, 0, 0, .3)"
		    }],
		    animationRule: "linear"
		});
		var gI = new RadialGauge({ 
			renderTo: "outputI",
			width: 200,
		    height: 200,
		    units: 'A',
		    title: "Battery Current",
		    minValue:-2.5,
		    maxValue: 2.5,
		    majorTicks: [ -2.5,-2, -1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5],
	     	minorTicks: 5,
    		strokeTicks: true,
    		highlights: [ {
		        "from": -2.5,
		        "to": -2,
		        "color": "rgba( 255, 0, 0, .3)"
		    },{
		        "from": -2,
		        "to": 0,
		        "color": "rgba(0, 255, 0, .3)"
		    },{
		        "from": 0,
		        "to": 2,
		        "color": "rgba(0, 0, 255, .3)"
		    },{
		        "from": 2.0,
		        "to": 2.5,
		        "color": "rgba(255, 0, 0, .3)"
		    }],
		    animationRule: "linear"
		});

	    websocket = new WebSocket(wsUri);
	    websocket.onopen    = function(evt) { console.log("WS CONNECTED"); };
	    websocket.onclose   = function(evt) { console.log("WS DISCONNECTED"); };
	    websocket.onmessage = function(evt) { 
			if( evt.data[0] != 'a' ){
				// console.log(evt.data);
				state = JSON.parse( evt.data );
				// outV.innerHTML = state["vBattVal"] + " mV";
				// outI.innerHTML = state["iBattVal"] + " mA";
				gV.value = state["vBattVal"]/1000;
				gI.value = state["iBattVal"]/1000;
			}
	    };
	    websocket.onerror   = function(evt) { outV.innerHTML = 'ERROR: ' + evt.data; };
  	}

	window.addEventListener("load", init, false);
</script>
</head>
<body>
<div id="main">
<p>
VeloGen = IOT bike computer ...
<ul>
<li><a href="/debug">Debug console</a></li>
<li><a href="/flash">OTA firmware update</a></li>
</ul>
</p>

<canvas id="outputV"></canvas>
<canvas id="outputI"></canvas>

</div>
</body></html>
